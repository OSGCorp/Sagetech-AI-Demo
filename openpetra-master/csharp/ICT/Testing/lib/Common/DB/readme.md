# C# Database Testing Subproject Of OpenPetra

The OpenPetra is a C# program that provides administrative management capabilities for non-profit organizations. The program handles financial transactions and contact management across multiple currencies and regions. This sub-project implements comprehensive database layer testing along with multithreaded operation validation. This provides these capabilities to the OpenPetra program:

- Validation of core database functionality including constraints, transactions, and PostgreSQL-specific features
- Verification of proper exception handling when database constraints are violated
- Multithreaded testing to ensure database operations work correctly under concurrent access
- Transaction isolation level testing to ensure data integrity

## Identified Design Elements

1. **Comprehensive Database Layer Testing**: Tests cover foreign key constraints, transaction isolation, sequence operations, and timestamp handling to ensure database integrity
2. **PostgreSQL-Specific Validation**: Specialized tests for PostgreSQL features like ILIKE queries and formatting ensure compatibility with the database backend
3. **Multithreaded Operation Testing**: Dedicated test infrastructure for concurrent database operations validates thread safety
4. **Synchronized Test Environment**: Uses ManualResetEvent objects and carefully designed thread management to create reproducible concurrency scenarios

## Overview
The architecture emphasizes thorough validation of database operations under various conditions, with particular attention to transaction integrity and concurrent access patterns. The test suite is structured to verify both basic database functionality and complex scenarios involving multiple simultaneous connections. By testing both single-threaded and multi-threaded database operations, this subproject ensures that OpenPetra's database layer remains robust and reliable across different deployment scenarios and load conditions.

## Business Functions

### Database Testing
- `test.cs` : Test suite for OpenPetra's database access layer with focus on transaction handling and SQL operations.
- `test.Multithreading.cs` : Test class for database multithreading functionality in OpenPetra, verifying thread-safe database connections and transactions.

## Files
### test.Multithreading.cs

This test file implements multithreaded database testing for OpenPetra's database layer. It contains a partial class TTestCommonDB with methods to test concurrent database operations across multiple threads. The class includes functionality for establishing connections, executing queries, and managing transactions simultaneously from different threads. Key features include testing various query methods (Select, SelectDT, ExecuteScalar), transaction isolation, and connection management. Important variables include thread synchronization objects (ManualResetEvent instances), database connection instances (FTestDBInstance1/2), and thread objects (FTestingThread1/2). Helper methods facilitate thread creation, database operations, and random timing for realistic concurrency scenarios.

 **Code Landmarks**
- `Line 84`: Uses action delegates to encapsulate database operations for execution on separate threads
- `Line 146`: Implements multiple database query methods to test different access patterns under concurrent conditions
- `Line 286`: Uses ManualResetEvent objects for thread synchronization between test threads and main thread
- `Line 329`: Thread-safe database connection establishment with error handling and signaling mechanism
### test.cs

This test file contains unit tests for the database access layer in OpenPetra. It tests core database functionality including foreign key constraints, transaction isolation levels, sequence operations, timestamp handling, and multi-row insertions. The tests verify proper exception handling when constraints are violated, ensure correct transaction behavior with different isolation levels, and validate PostgreSQL-specific query formatting. Key tests include TestForeignKeyConstraints, TestOrderStatementsInTransaction, TestSequence, TestTimeStamp, and TestPostgreSQL_ILIKE. The file is part of a partial class that continues in another file for multithreading tests.

 **Code Landmarks**
- `Line 70`: Tests use a dedicated database connection name constant for isolation between test cases
- `Line 221`: Tests foreign key constraint violations by deliberately attempting invalid operations
- `Line 258`: Tests the order of SQL statements within a transaction to verify constraint checking behavior
- `Line 401`: Tests PostgreSQL-specific LIKE to ILIKE substitution for case-insensitive searches
- `Line 450`: Tests transaction isolation level compatibility checking with different scenarios

[Generated by the Sage AI expert workbench: 2025-03-30 02:22:57  https://sage-tech.ai/workbench]: #